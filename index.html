<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é…é”è·ç‰©ä¸€æ‹¬é›†è¨ˆãƒ¢ãƒ‹ã‚¿ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { background-color: #0D1117; color: #C9D1D9; font-family: sans-serif; }
        .driver-card { background: #161B22; border: 1px solid #30363D; border-radius: 1rem; padding: 1.25rem; height: fit-content; }
        .da-badge { background: #0D1117; border: 1px solid #30363D; color: #58A6FF; font-family: monospace; font-size: 0.85rem; padding: 0.2rem 0.5rem; border-radius: 0.4rem; display: inline-block; margin: 2px; }
        .drop-zone { border: 2px dashed #30363D; transition: all 0.3s; }
        .drop-zone.active { border-color: #58A6FF; background: rgba(88, 166, 255, 0.1); }
        .count-badge { background: #238636; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.9rem; font-weight: bold; }
    </style>
</head>
<body class="p-4">

    <header class="mb-6 flex justify-between items-end border-b border-[#30363D] pb-4">
        <div>
            <h1 class="text-2xl font-black text-white tracking-tighter uppercase">Delivery Aggregator</h1>
            <p class="text-xs text-gray-500 font-bold">ã‚¨ã‚¯ã‚»ãƒ«é›†è¨ˆãƒ»ãƒ‰ãƒ©ã‚¤ãƒãƒ¼åˆ¥ä¸€è¦§</p>
        </div>
        <button onclick="location.reload()" class="text-xs bg-[#30363D] hover:bg-[#444c56] text-white px-3 py-1 rounded-md transition-all">ãƒªã‚»ãƒƒãƒˆ</button>
    </header>

    <div id="drop-area" class="drop-zone mb-8 p-10 rounded-2xl text-center cursor-pointer">
        <div class="text-4xl mb-3">ğŸ“Š</div>
        <p class="text-sm font-bold text-gray-400">ã‚¨ã‚¯ã‚»ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</p>
        <p class="text-[10px] text-gray-600 mt-2 uppercase tracking-widest">or click to select file</p>
        <input type="file" id="file-input" class="hidden" accept=".xlsx, .xls, .csv">
    </div>

    <div id="result-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>

    <script>
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');

        // ã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
        dropArea.addEventListener('click', () => fileInput.click());

        // ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.classList.add('active');
        });

        dropArea.addEventListener('dragleave', () => dropArea.classList.remove('active'));

        // ãƒ‰ãƒ­ãƒƒãƒ—æ™‚ã®å‡¦ç†
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.classList.remove('active');
            const file = e.dataTransfer.files[0];
            handleFile(file);
        });

        fileInput.addEventListener('change', (e) => {
            handleFile(e.target.files[0]);
        });

        function handleFile(file) {
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];
                const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                processData(json);
            };
            reader.readAsArrayBuffer(file);
        }

        function processData(data) {
            // ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã”ã¨ã®é›†è¨ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
            const summary = {};

            // ãƒ‡ãƒ¼ã‚¿ã®è§£æï¼ˆ1è¡Œç›®ã¯ãƒ˜ãƒƒãƒ€ãƒ¼ã¨æƒ³å®šã—ã€2è¡Œç›®ã‹ã‚‰ãƒ«ãƒ¼ãƒ—ï¼‰
            data.forEach((row, index) => {
                if (index === 0) return; 

                // ã‚¨ã‚¯ã‚»ãƒ«ã®åˆ—é †ã«åŸºã¥ãå–å¾—ï¼ˆAåˆ—:DAç•ªå·, Båˆ—:åå‰ ã¨æƒ³å®šï¼‰
                // â€»ã‚‚ã—åˆ—ãŒé€†ãªã‚‰ã“ã“ã‚’å…¥ã‚Œæ›¿ãˆã¦ãã ã•ã„
                const da = String(row[0] || "").trim();
                const name = String(row[1] || "").trim();

                if (da && name) {
                    if (!summary[name]) {
                        summary[name] = [];
                    }
                    summary[name].push(da);
                }
            });

            renderGrid(summary);
        }

        function renderGrid(summary) {
            const grid = document.getElementById('result-grid');
            const dropZone = document.getElementById('drop-area');
            grid.innerHTML = '';
            
            // å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’å°ã•ãã™ã‚‹
            dropZone.classList.add('hidden');

            const names = Object.keys(summary).sort();

            if (names.length === 0) {
                alert("ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿å–ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã‚¨ã‚¯ã‚»ãƒ«ã®Aåˆ—ã«DAç•ªå·ã€Båˆ—ã«åå‰ãŒå…¥ã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                dropZone.classList.remove('hidden');
                return;
            }

            names.forEach(name => {
                const das = summary[name];
                const card = document.createElement('div');
                card.className = 'driver-card shadow-2xl';
                
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-4 border-b border-white/5 pb-2">
                        <h2 class="text-lg font-black text-white tracking-tight">ğŸ‘¤ ${name}</h2>
                        <span class="count-badge">${das.length} <span class="text-[10px]">å€‹</span></span>
                    </div>
                    <div class="flex flex-wrap gap-1">
                        ${das.map(da => `<span class="da-badge">${da}</span>`).join('')}
                    </div>
                `;
                grid.appendChild(card);
            });
        }
    </script>
</body>
</html>
